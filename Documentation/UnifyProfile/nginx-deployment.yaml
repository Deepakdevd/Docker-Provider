apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
      annotations:
        app: nginx
        description: "nginx web server"
        version: "1.14.2"
    spec:
      nodeSelector:
       kubernetes.io/os: linux
      containers:
      - name: nginx
        image: nginx:1.14.2
        ports:
        - containerPort: 80
        env:
         - name: POD_NAME
           valueFrom:
            fieldRef:
              fieldPath: metadata.name
         - name: POD_NAMESPACE
           valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
         - name: POD_UID
           valueFrom:
            fieldRef:
              fieldPath: metadata.uid
         - name: NODE_NAME
           valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
         - name: CONTAINER_NAME
           value: nginx  #required manually passing container name
         - name: AKS_RESOURCE_ID
           value: /subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/xxxxxx-aks-rg/providers/Microsoft.ContainerService/managedClusters/xxxxxx-aks #required manually passing AKS resource id
         - name: K8S_CLUSTER_NAME
           value: xxxxxx-aks #required manually passing AKS cluster name
         - name: CLOUD_PROVIDER
           value: azure #required manually passing cloud provider
         - name: CLOUD_PLATFORM
           value: azure_aks #required manually passing cloud platform
         - name: CLOUD_REGION
           value: eastus #required manually passing cloud region
        #  - name: POD_LABELS
        #    valueFrom:
        #     fieldRef:
        #       fieldPath: metadata.labels
        #  - name: POD_ANNOTATIONS
        #    valueFrom:
        #       fieldRef:
        #         fieldPath: metadata.annotations
         - name: OTEL_RESOURCE_ATTRIBUTES
           value: cloud.provider=$(CLOUD_PROVIDER),cloud.platform=$(CLOUD_PLATFORM),cloud.region=${CLOUD_REGION},cloud.resource_id=${AKS_RESOURCE_ID},k8s.cluster.name=${K8S_CLUSTER_NAME},k8s.pod.name=$(POD_NAME),k8s.pod.uid=$(POD_UID),k8s.namespace.name=$(POD_NAMESPACE),k8s.node.name=$(NODE_NAME),k8s.container.name=$(CONTAINER_NAME)
         # downward API doesnt support k8s.pod.labels and k8s.pod.annotations



